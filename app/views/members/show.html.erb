<div class="page-header">
  <%= render :partial => "shared/member_information" %>
</div>

<div class="row">
  
  <div class="span4">
    <table>
      <tr>
        <td><%= t('activerecord.attributes.member.member_id') %>:</td>
        <td><input id="input_visible_id" readonly="true" type="text" class="test_field" value="<%= @current_member.visible_id %>" /></td>
      </tr>
      <tr>
        <td><%= t('activerecord.attributes.member.first_name') %>:</td>
        <td><input id="input_first_name" readonly="true" type="text" class="test_field" value="<%= @current_member.first_name %>" />
        </td>
      </tr>
      <tr>
        <td><%= t('activerecord.attributes.member.last_name') %>:</td>
        <td><input id="input_last_name" readonly="true" type="text" class="test_field" value="<%= @current_member.last_name %>" />
        </td>
      </tr>
      <tr>
        <td><%= t('activerecord.attributes.member.gender') %>:</td>
        <td>
          <input id="input_gender" readonly="true" type="text" class="test_field" value="<%= @current_member.gender == 'F' ? 'Female' : 'Male' %>" />
        </td>  
      </tr>
      <tr>
        <td><%= t('activerecord.attributes.member.member_classification_type') %>:</td>
        <td>
          <input id="input_member_group_type" readonly="true" type="text" class="test_field" value="<%= @current_member.member_group_type.nil? ? t('activerecord.attributes.member.not_group_associated') : @current_member.member_group_type.name %>" />
        </td>  
      </tr>
    </table>
  </div>
  
  <div class="span8">
    
    <div class="row-fluid">
      <div class="span4">
        <%= link_to 'Edit', edit_member_path, :class => "btn btn-success btn-large-w" %>
      </div>
      <div class="span4">
        <% disable_save_sale = @current_member.can_save_the_sale? == false  %>
        <%= link_to("Save the sale", (!disable_save_sale ? member_save_the_sale_path : "#"), :class => "btn btn-large-w #{(disable_save_sale ? "disabled" : "btn-info")}") %>
      </div>
      <div class="span4">
        <% disable_black_list = @current_member.blacklisted? == true && @current_member.lapsed? == true %>
        <%= link_to "Blacklist", (!disable_black_list ? member_blacklist_path : "#"), :class => "btn btn-large-w #{(disable_black_list ? "disabled" : "btn-danger")}" %>
      </div>
    </div>

    <div class="row-fluid" style="margin-top: 8px;">
      <div class="span4">
        <%= link_to "Add a note", new_member_note_path, :class => "btn btn-success btn-large-w" %>
      </div>
      <div class="span4">&nbsp</div>
      <div class="span4">
        <% disable_cancel = @current_member.can_be_canceled? == false %>
        <%= link_to("Cancel", (!disable_cancel ? member_cancel_path : "#"), :class => "btn  btn-large-w #{(disable_cancel ? "disabled" : "btn-danger")}")  %>
      </div>
    </div>  

    <div class="row-fluid" style="margin-top: 8px;">
      <div class="span4">
        <%= form_for @current_member, :url => member_recover_path, :method => :post, do |f| %>
            <% if @current_member.lapsed? %>
              <%= f.submit t('recover'), :class => 'btn btn-success', :style => "width: 182px;" %>
            <% else %>
              <%= f.submit t('recover'), :class => 'btn', :style => "width: 182px;", :disabled => true %>
            <% end %>
        <% end %>
      </div>
      <% disable_applied = @current_member.applied? == false  %>
      <% unless disable_applied %>
        <div class="span4">
          <%= link_to "Approve", member_approve_path, :class => "btn btn-large-w btn-info", :confirm => t('are_you_sure'), :method => :post %>
        </div>
        <div class="span4">
          <%= link_to "Reject", member_reject_path, :class => "btn btn-large-w btn-danger", :confirm => t('are_you_sure'), :method => :post %>
        </div>
      <% end %>
    </div>  
</div>


<table id="table_demographic_information" class="table table-bordered table-condensed">
  <thead>
    <tr class="box_title"><th colspan="6"><h4>Demographic Information</h4></th></tr>
  </thead>
  <tbody>
    <tr>
      <th style="width: 20%;">Address</th><th  style="width: 20%;">City</th><th>State</th><th>Country</th><th>Zip</th><th>Actions</th>
    </tr>
    <tr class="<%= (!@current_member.wrong_address.nil? ? "yellow" : "") %>">
      <td><%= @current_member.address %></td>
      <td><%= @current_member.city %></td>
      <td><%= @current_member.state %></td>
      <td><%= @current_member.country %></td>
      <td><%= @current_member.zip %></td>
      <td>
        <% if @current_member.wrong_address.nil? %>
          <%= link_to(member_set_undeliverable_path, :class => "btn btn-danger", :id => "link_member_set_undeliverable") do %> 
            <i class="icon-remove"></i> <%= t('activerecord.attributes.member.set_undeliverable') %>
          <% end %>        
        <% else %>
          <%= t('activerecord.attributes.member.undeliverable') %>
        <% end %>
      </td>
    </tr>
  </tbody>
</table>

<table id="table_contact_information" class="table table-bordered table-condensed">
  <thead>
    <tr class="box_title"><th colspan="4"><h4>Contact Information</h4></th></tr>
  </thead>
  <tbody>
    <tr>
      <th><%= t('activerecord.attributes.member.phone_number') %></th><th><%= t('activerecord.attributes.member.type_of_phone_number') %></th><th>Email</th><th>Birth date</th>
    </tr>
    <tr class="<%= (!@current_member.wrong_phone_number.nil? ? "yellow" : "") %>">
      <td nowrap="nowrap">
        <%= @current_member.full_phone_number %>
        <% if @current_member.wrong_phone_number.nil? %>
          <%= link_to(member_set_unreachable_path, :class => "btn btn-danger", :id => "link_member_set_unreachable") do %> 
            <i class="icon-remove"></i> <%= t('activerecord.attributes.member.set_unreachable') %>
          <% end %>        
        <% else %>
          <%= @current_member.wrong_phone_number %>
        <% end %>
      </td>
      <td> <%= @current_member.type_of_phone_number %></td>
      <td nowrap="nowrap"><a href="mailto:<%= @current_member.email %>"><%= @current_member.email %></a></td>
      <td nowrap="nowrap"><%= @current_member.birth_date.nil? ? t('activerecord.attributes.member.not_have_birth_date_set') : @current_member.birth_date %></td>
    </tr>
  </tbody>
</table>


<table id="table_active_credit_card" class="table table-bordered table-condensed">
  <thead>
    <tr class="box_title">
      <th><h4>Active Credit Card</h4></th>
      <td style="border: none; text-align: right;">
        <%= link_to(new_credit_card_path, :class => "btn btn-success") do %> 
          <i class="icon-plus"></i> Add a credit card
        <% end %>
      </td>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th><%= t("activerecord.attributes.credit_card.expire_date") %></th>
      <th>
      <% if can? :see_credit_card, @active_credit_card %>
        <%= t("activerecord.attributes.credit_card.number") %>
      <% elsif can? :see_credit_card_last_digits, @active_credit_card %>
        <%= t("activerecord.attributes.credit_card.last_digits") %>
      <% end %>
      </th>
    </tr>
    <% if @active_credit_card %>
      <tr class="<%= (@active_credit_card.am_card.expired? ? "card_expired" : "") %>">
        <td><%= @active_credit_card.expire_month %> / <%= @active_credit_card.expire_year %></td>
        <td>
          <% if can? :see_credit_card, @active_credit_card %>
            <%= @active_credit_card.number %>
          <% elsif can? :see_credit_card_last_digits, @active_credit_card %>
            <%= @active_credit_card.last_digits %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>



<table id="table_membership_information" class="table table-bordered table-condensed table-nohover">
  <thead>
    <tr class="box_title"><th colspan="2"><h4>Membership Information</h4></th></tr>
  </thead>
  <tbody>
    <tr>
      <td style="width: 50%;">
        <table class="hidden_table_border">
          <tr>
            <th>Status:</th>
            <td id="td_mi_status"><span style="height: 20px; padding: 4px;" class="<%= menber_status_class(@current_member) %>"><b><%= @current_member.status %></b></span></td>  
          </tr>
          <tr>
            <th><%= t('activerecord.attributes.member.member_since_date') %>:</th>
            <td id="td_mi_member_since_date"><%= I18n.l @current_member.member_since_date, :format => :only_date %></td>  
          </tr>
          <tr>
            <th><%= t('menu.activerecord.term_of_membership') %>:</th>
            <td id="td_mi_terms_of_membership_name">
              <%= link_to(terms_of_membership_path(:id => @current_member.terms_of_membership), :class => "btn btn-small") do %> 
                <i class="icon-zoom-in"></i> <%= @current_member.terms_of_membership.name %>
              <% end %>
            </td>  
          </tr>
          <tr>
            <th> <%= t('activerecord.attributes.member.created_by') %>: </th>
            <td id="td_mi_created_by"> <%= @current_member.created_by.try(:username) %> </td>
          </tr>
          <tr>
            <th><%= t('activerecord.attributes.member.recovery_times') %>:</th>
            <td id="td_mi_reactivation_times"><%= @current_member.reactivation_times %></td>  
          </tr>
          <tr>
            <th><%= t('activerecord.attributes.member.recycled_times') %>:</th>
            <td id="td_mi_recycled_times">
              <%= @current_member.recycled_times %>
              <%= render :partial => "shared/help", :locals => { :title => t('activerecord.attributes.member.recycled_times'), :content => t('activerecord.attributes.member.recycled_times_explanation')} %> 
            </td>  
          </tr>
          <% if @current_member.club.requires_external_id %>
          <tr>
            <th><%= t('activerecord.attributes.member.external_id') %>:</th>
            <td id="td_mi_external_id"><%= @current_member.external_id %></td>  
          </tr>
          <% end %>
        </table>
      </td>
      <td style="width: 50%;">
        <table class="hidden_table_border">
          <tr>
            <th><%= t('activerecord.attributes.member.join_date') %>:</th>
            <td id="td_mi_join_date"><%= I18n.l @current_member.join_date, :format => :only_date %></td>
          </tr>
          
          <tr class="ligthgrey">
            <th><%= t('activerecord.attributes.member.next_retry_bill_date') %>:</th>
            <td id="td_mi_next_retry_bill_date">
              <%= @current_member.next_retry_bill_date %>&nbsp;&nbsp;&nbsp;
              <% unless @current_member.next_retry_bill_date.nil? || @current_member.lapsed? %>
                <%= link_to(member_change_next_bill_date_path, :class => "btn btn-info", :id => "link_member_change_next_bill_date") do %> 
                  <i class="icon-pencil"></i> Change
                <% end %>
              <% end %>
            </td>
          </tr>

          <tr>
            <th><%= t('activerecord.attributes.member.cancel_date') %>:</th>
            <td><%= I18n.l(@current_member.cancel_date, :format => :dashed) unless @current_member.cancel_date.nil? %></td>  
          </tr>
  
          <tr class="ligthgrey">
            <th><%= t('activerecord.attributes.member.club_cash_amount') %>:</th>
            <td id="td_mi_club_cash_amount">
              <%= @current_member.club_cash_amount.to_f %>&nbsp;&nbsp;&nbsp;
              <% unless disable_save_sale %>
                <%= link_to(member_add_club_cash_path, :class => "btn btn-success") do %> 
                  <i class="icon-plus"></i> <%= t('activerecord.attributes.member.add_club_cash_transaction') %>
                <% end %>
              <% end %>
            </td>  
          </tr>
          <tr>
            <th> <%= t('activerecord.attributes.member.club_cash_expire_date') %>: </th>
            <td id="td_mi_club_cash_expire_date"> <%= @current_member.club_cash_expire_date %> </td>
          </tr>
          <tr>
            <th><%= t('activerecord.attributes.member.quota') %>: </th>
            <td id="td_mi_quota"><%= @current_member.quota %></td>  
          </tr>
          <tr>
            <th><%= t('activerecord.attributes.member.date_of_primary_cc') %>: </th>
            <td id="td_mi_credit_cards_first_created_at"><%= @current_member.credit_cards.first && I18n.l(@current_member.credit_cards.first.created_at, :format => :only_date) %> </td>
          </tr>
          <tr>
            <th><%= t('activerecord.attributes.member.last_successful_bill_date') %>: </th>
            <td><%= I18n.l(@current_member.active_credit_card.last_successful_bill_date, :format => :only_date) if @current_member.active_credit_card.try(:last_successful_bill_date) %> </td>
          </tr>
        </table>        
      </td>
    </tr>
  </tbody>
</table>

<% if @enrollment_info and not @enrollment_info.preferences.nil? %>
  <table id="table_enrollment_info" class="table table-bordered table-condensed table-nohover">
    <thead>
      <tr class="box_title"><th><h4>Preferences</h4></th></tr>
    </thead>
    <tbody>
      <% @enrollment_info.preferences.each do |key, value| %>
        <tr><td> <%= key %>: <%= value %> </td></tr>
      <% end %>
    </tbody>
  </table>
<% end %>

<ul class="nav nav-tabs">
  <li class="active"><a href="#operations" data-toggle="tab">Operations</a></li>
  <li><a href="#notes" data-toggle="tab">Notes</a></li>
  <li><a href="#credit_cards" data-toggle="tab">Credit Cards</a></li>
  <li><a href="#transactions" data-toggle="tab">Transactions</a></li>
  <li><a href="#fulfillments" data-toggle="tab">Fulfillments</a></li>
  <li><a href="#communication" data-toggle="tab">Communications</a></li>
  <% if @current_member.api_member %>
    <li><a href="#sync_status" data-toggle="tab">Sync Status</a></li>
  <% end %>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="operations">
    <div class="tab_body_padding">
      <%= render :partial => 'operations', :locals => { :operations => @operations} %>
    </div>
  </div>
  <div class="tab-pane" id="notes">
    <div class="tab_body_padding">
      <%= render :partial => 'notes', :locals => { :notes => @notes} %>
    </div>
  </div>
  <div class="tab-pane" id="credit_cards">
    <div class="tab_body_padding">
      <%= render :partial => 'credit_cards', :locals => { :credit_cards => @credit_cards} %>
    </div>
  </div>  
  <div class="tab-pane" id="transactions">
    <div class="tab_body_padding">
      <%= render :partial => 'transactions', :locals => { :transactions => @transactions} %>
    </div>
  </div>
  <div class="tab-pane" id="fulfillments">
    <div class="tab_body_padding">
      <%= render :partial => 'fulfillments', :locals => { :fulfillments => @fulfillments} %>
    </div>
  </div>  
  <div class="tab-pane" id="communication">
    <div class="tab_body_padding">
      <%= render :partial => 'communications', :locals => { :communications => @communications} %>
    </div>
  </div>
  <% if @current_member.api_member %>
    <div class="tab-pane" id="sync_status">
      <div class="tab_body_padding">
        <%= render :partial => 'sync_status', :locals => { :member => @current_member} %>
      </div>
    </div>
  <% end %>
</div>

<script>
  $(document).ready(show_member_functions());
</script>
