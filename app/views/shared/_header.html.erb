<div id="ajax_loader"><p><%=t('loading')%></p></div>
<div class="navbar">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>

      <a class="brand" href="<%= root_path %>">SacPlatform <%= Rails.env if Rails.env != 'production' %></a>

      <% if current_agent %>
        <div class="container nav-collapse">
          <% if @current_club.nil? %>
            <% if not @current_partner.nil? and @current_agent.can?(:read,Partner) %>
              <%= link_to @current_partner.name, admin_partner_dashboard_path %>
            <% end %>
          <% else %>
            <% if @current_club.logo? %>
              <%= link_to image_tag(@current_club.logo.url(:header)), users_path(@current_partner.prefix, @current_club.name) %>
            <% else %>
              <%= link_to @current_club.full_name, users_path(@current_partner.prefix, @current_club.name) %>
            <% end %>
          <% end %>

          <ul class="nav pull-right">
            <li class="divider-vertical"></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"><%= current_agent.username %><b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><%= link_to t('menu.logout'), destroy_agent_session_path, :method => :delete, :id => "link_logout"  %></li>
              </ul>
            </li>
          </ul>

          <% unless @current_club.nil? %>
            <ul class="nav pull-right">
              <li class="divider-vertical"></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><%= @current_club.name %><b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <% if @current_agent.can? :read, User, @current_club.id %>
                    <li><%= link_to t('activerecord.model.users'), users_path(@current_club.partner.prefix, @current_club.name) %></li>
                  <% end %>
                  <% if @current_agent.can? :read, Product, @current_club.id %>
                    <li><%= link_to t('activerecord.model.products'), products_path(@current_club.partner.prefix, @current_club.name) %></li>
                  <% end %>
                  <% if @current_agent.can? :read, Fulfillment, @current_club.id %>
                    <li><%= link_to t('activerecord.model.fulfillments'), fulfillments_index_path(@current_club.partner.prefix, @current_club.name) %></li>
                  <% end %>
                  <% if @current_agent.can? :read, Fulfillment, @current_club.id %>
                    <li><%= link_to t('activerecord.model.fulfillment_files'), list_fulfillment_files_path(@current_club.partner.prefix, @current_club.name) %></li>
                  <% end %>
                  <% if @current_agent.can? :read, DispositionType, @current_club.id %>
                    <li><%= link_to t('activerecord.model.disposition_types'), disposition_types_path(@current_club.partner.prefix, @current_club.name) %></li>
                  <% end %>                  
                  <% if @current_agent.can? :read, TermsOfMembership, @current_club.id %>
                    <li><%= link_to t('activerecord.model.subscription_plans'), terms_of_memberships_path(@current_club.partner.prefix, @current_club.name) %></li>
                  <% end %>
                  <% if @current_agent.can? :edit, Club, @current_club.id %>
                    <li><%= link_to t('button.club_show'), club_path(@current_club.partner.prefix, @current_club.id) %></li>
                  <% end %>
                </ul>
              </li>
            </ul>
          <% end %>

          <ul class="nav">
            <% if @current_agent.is_admin? %>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"> <%= I18n.t("menu.admin_menu") %> <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><%= link_to t('menu.agents'), admin_agents_path if @current_agent.is_admin? %></li>
                <li><%= link_to t('menu.partners'), admin_partners_path if @current_agent.can? :read, Agent %></li>
                <li><%= link_to "DelayedJobs", admin_delayed_jobs_path if @current_agent.can? :read, DelayedJob %></li>
              </ul>
            </li>
            <% end %>
            <li><%= link_to "My Clubs", root_path, {id: "my_clubs"} %></li>
            <li>
              <% selected = @current_club ? [ users_path(@current_partner.prefix, @current_club.name) ] : nil %>
              <%= select_tag "change_partner",
                options_for_select((@current_agent.has_global_role? ? Club.includes(:partner).all : Club.includes(:partner).find(@current_agent.club_roles_without_api)).collect{ |u| [ "#{u.partner.prefix} - #{u.name}", users_path(u.partner.prefix, u.name) ]}, 
                  selected ), 
                :prompt => 'Select Partner-Club',
                :onchange => "window.open(this.options[this.selectedIndex].value, '_top')", :style => "margin-top: 5px;" %>
                <%=  %>
            </li>
          </ul>

        </div><!--/.nav-collapse -->
      <% end %>           
    </div>
  </div>
</div>
