<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Api::MembersController
  
    &mdash; Documentation by YARD 0.8.2.1
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (M)</a> &raquo;
    <span class='title'>Api</span>
     &raquo; 
    <span class="title">MembersController</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Api::MembersController
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">ApplicationController</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ApplicationController</li>
          
            <li class="next">Api::MembersController</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">app/controllers/api/members_controller.rb</dd>
  
</dl>
<div class="clear"></div>








  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#club_cash-instance_method" title="#club_cash (instance method)">- (String, ...) <strong>club_cash</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Method : PUT Updates club cash&#8217;s data.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-instance_method" title="#create (instance method)">- (String, ...) <strong>create</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Method : POST.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show-instance_method" title="#show (instance method)">- (String, ...) <strong>show</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Method : GET Returns information related to member and its credit card.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-instance_method" title="#update (instance method)">- (String, ...) <strong>update</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Method : PUT Updates member&#8217;s data.
</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="club_cash-instance_method">
  
    - (<tt>String</tt>, ...) <strong>club_cash</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Method : PUT Updates club cash&#8217;s data.
</p>
<dl>
<dt>url</dt><dd><p>
/api/v1/members/:id/club_cash
</p>
</dd>
<dt>id</dt><dd><p>
ID of the member. This ID is unique for each member. (32 characters
string). This value is used by platform. Have in mind that this value is
part of the url.
</p>
</dd>
<dt>amount</dt><dd><p>
club cash amount to be set on this member profile <tt>required</tt>
</p>
</dd>
<dt>expire date</dt><dd><p>
club cash expiration date <tt>required</tt>
</p>
</dd>
<dt>message</dt><dd><p>
Shows the method results and also informs the errors.
</p>
</dd>
<dt>code</dt><dd><p>
Code related to the method result.
</p>
</dd>
<dt>v_id</dt><dd><p>
Visible id of the member that was updated.
</p>
</dd>
<dt>errors</dt><dd><p>
A hash with members errors. This will be use to show errors on members edit
page.
</p>
</dd>
</dl>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>member</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<b>message</b>
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<b>member_id</b>
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<b>code</b>
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<b>errors</b>
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/api/members_controller.rb', line 305</span>

<span class='kw'>def</span> <span class='id identifier rubyid_club_cash'>club_cash</span>
  <span class='id identifier rubyid_member'>member</span> <span class='op'>=</span> <span class='const'>Member</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_my_authorize!'>my_authorize!</span> <span class='symbol'>:api_update_club_cash</span><span class='comma'>,</span> <span class='const'>Member</span><span class='comma'>,</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_club_id'>club_id</span>
  <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>This club is not allowed to fix the amount of the club cash on members.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:code</span> <span class='op'>=&gt;</span> <span class='const'>Settings</span><span class='period'>.</span><span class='id identifier rubyid_error_codes'>error_codes</span><span class='period'>.</span><span class='id identifier rubyid_club_cash_cant_be_fixed'>club_cash_cant_be_fixed</span><span class='comma'>,</span> <span class='symbol'>:member_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='rbrace'>}</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_club'>club</span><span class='period'>.</span><span class='id identifier rubyid_club_cash_transactions_enabled'>club_cash_transactions_enabled</span>
    <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_skip_api_sync!'>skip_api_sync!</span>
    <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_club_cash_amount'>club_cash_amount</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:amount</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_club_cash_expire_date'>club_cash_expire_date</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:expire_date</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span><span class='lparen'>(</span><span class='symbol'>:validate</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Member updated successfully</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'>Auditory</span><span class='period'>.</span><span class='id identifier rubyid_audit'>audit</span><span class='lparen'>(</span><span class='id identifier rubyid_current_agent'>current_agent</span><span class='comma'>,</span> <span class='id identifier rubyid_member'>member</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='id identifier rubyid_member'>member</span><span class='comma'>,</span> <span class='const'>Settings</span><span class='period'>.</span><span class='id identifier rubyid_operation_types'>operation_types</span><span class='period'>.</span><span class='id identifier rubyid_profile_updated'>profile_updated</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='symbol'>:code</span> <span class='op'>=&gt;</span> <span class='const'>Settings</span><span class='period'>.</span><span class='id identifier rubyid_error_codes'>error_codes</span><span class='period'>.</span><span class='id identifier rubyid_success'>success</span><span class='comma'>,</span> <span class='symbol'>:member_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='id identifier rubyid_response'>response</span>
<span class='kw'>rescue</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>RecordNotFound</span>
  <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='lbrace'>{</span> <span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Member not found</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:code</span> <span class='op'>=&gt;</span> <span class='const'>Settings</span><span class='period'>.</span><span class='id identifier rubyid_error_codes'>error_codes</span><span class='period'>.</span><span class='id identifier rubyid_not_found'>not_found</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create-instance_method">
  
    - (<tt>String</tt>, ...) <strong>create</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Method : POST
</p>
<p>
Submits a member to be created. THis method will call the method enroll on
member model. It will validate the member&#8217;s data (including its
credit card) and, in case it is correct, it will create and save the
member. It will also send a welcome email and charge the enrollment to the
member&#8217;s credit card.  
</p>
<dl>
<dt>url</dt><dd><p>
/api/v1/members
</p>
</dd>
<dt>current_agent</dt><dd><p>
The agent&#8217;s ID that will be enrolling the member. 
</p>
</dd>
<dt>member</dt><dd><p>
Information related to the member that is sumbitting the enroll. It also
contains information related to the enrollment (this will be stored as
enrollment_info). Here is a list of the regex we are using to validate
<span class='object_link'><a href="../Member.html" title="Member (class)">show</a></span>.
</p>
<pre class="code ruby"><code>
   *first_name: The first name of the member that is enrolling. We are not accepting any invalid character (like: #$&quot;!#%&amp;%&quot;).
   *last_name: The last name of the member that is enrolling. We are not accepting any invalid character (like: #$&quot;!#%&amp;%&quot;). 
   *address: The address of the member that is being enrolled.
   *city: City from where the member is from.
   *state: The state standard code where the member is from. 
   *zip: Member's address's zip code. We are accepting only formats like: xxxxx or xxxxx-xxxx. Only numbers.
   *country: The country standard code where the member is from. This code has a length of 2 digits. (Eg: US for United States).
   *phone_country_code: First field of the phone number. This is the number related to the country the phone number is from. (Eg. For United States it would be &quot;011&quot;). 
   *phone_area_code: Second field of the phone number. This is the number related to the area the phone number is from. 
   *phone_local_number: Third and last field of the phone_number. This is the local number where the member will be reached.
   *email: Members personal email. This mail will be one of our contact method and every mail will be send to this. We recommend frontend to
    validate mails with the following formts like: xxxxxxxxx@xxxx.xxx.xx or xxxxxx+xxx@xxxx.xxx.xx
   *gender: Gender of the member. The values we are recieving are &quot;M&quot; for male or &quot;F&quot; for female.
   *type_of_phone_number: Type of the phone number the member has input (home, mobile, others).
   *terms_of_memberhips_id: This is the id of the term of membership the member is enrolling with. With this param
    we will set some features such as provisional days or amount of club cash the member will start with. It is present at member level. 
   *enrollment_amount: Amount of money that takes to enroll. It is present at member level.
   *birth_date: Birth date of the member. This date is stored with format &quot;yyyy-mm-dd&quot;
   *credit_card  [Hash]
   *prospect_id: Id of the prospect the enrollment info is related to.
   *product_sku: Freeform text that is representative of the SKU. This will be passed with format string, each product separated with ',' (comma). (Example: &quot;kit-card,circlet&quot;)
   *product_description: Description of the selected product.
   *mega_channel: 
   *marketing_code: multi-team
   *fulfillment_code: Id of the fulfillment we are sending to our member. (car-flag).
   *ip_address: Ip address from where the enrollment is being submitted.
   *user_agent: Information related to the browser and computer from where the enrollment is being submitted.
   *referral_host:  Link where is being redirect when after subimiting the enroll. (It shows the params in it).
   *referral_parameters
   *referral_path
   *user_id: User ID alias UID is an md5 hash of the user's IP address and user-agent information.
   *landing_url: Url from where te submit comes from.
   *preferences: Information about the preferences selected when enrolling. This will be use to know about the member likes.
    this information is selected by the member. This information is stored with format as hash encoded with json.
   *cookie_value: Cookie from where the enrollment is being submitted.
   *cookie_set: If the cookie_value is being recieved or not. It also informs if the client has setted a cookie on his side.
   *campaign_medium
   *campaign_description: The name of the campaign.
   *campaign_medium_version
   *joint: It shows if it is set as type joint. It is use to see if at the end of the contract we have with the partner, we share the member's 
    informati??n with him. joint=1 means we will share this informati??n. If it is null, we will automaticaly set it as 0. 
    This is an exclusive value, it can be seted using 1 or 0, or true or false. It is present at member level.
</code></pre>
</dd>
<dt>credit_card</dt><dd><p>
Information related to member&#8217;s credit card. <span class='object_link'><a href="../CreditCard.html" title="CreditCard (class)">show</a></span>
</p>
<pre class="code ruby"><code>
  *number: Number of member's credit card, from where we will charge the membership or any other service.  
   This number will be stored as a hashed value. This number can have white-spaces or not ()
  *expire_month: The month (in numbers) in which the credit card will expire. Eg. For june it would be 6. 
  *expire_year: The year (in numbers) in which the credit card will expire.  
</code></pre>
</dd>
<dt>setter</dt><dd><p>
Variable used to pass some boolean values as &#8220;cc_blank&#8221; for
enrolling, or &#8220;wrong_address&#8221; for update.
</p>
<pre class="code ruby"><code>
 * cc_blank: Boolean variable which will tell us to allow or not enrolling a member with a blank credit card. It should only be true
             when we are allowing a credit blank credit card. If this variable is true, it should be pass a credit_card with the following 
             attributes: number=&gt;&quot;0000000000&quot; and expire_month and expired_year setted as today's month and year respectively.
 * skip_api_sync: Boolean variable which tell us if we have to sync or not user to remote api (e.g drupal)
</code></pre>
</dd>
<dt>message</dt><dd><p>
Shows the method results and also informs the errors.
</p>
</dd>
<dt>code</dt><dd><p>
Code related to the method result.
</p>
</dd>
<dt>member_id</dt><dd><p>
ID of the member. This ID is unique for each member. (32 characters
string). This value is used by platform. API users dont know the member id
at this moment.
</p>
</dd>
<dt>v_id</dt><dd><p>
Visible id of the member that was enrolled or recovered, or updated.
</p>
</dd>
<dt>errors</dt><dd><p>
A hash with members and credit card errors. This will be use to show errors
on members creation page.
</p>
</dd>
</dl>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>member</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>setter</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<b>message</b>
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<b>code</b>
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<b>member_id</b>
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<b>v_id</b>
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<b>errors</b>
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


83
84
85
86
87
88
89
90
91
92
93
94
95
96
97</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/api/members_controller.rb', line 83</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
  <span class='id identifier rubyid_tom'>tom</span> <span class='op'>=</span> <span class='const'>TermsOfMembership</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:member</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:terms_of_membership_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>  
  <span class='id identifier rubyid_my_authorize!'>my_authorize!</span> <span class='symbol'>:api_enroll</span><span class='comma'>,</span> <span class='const'>Member</span><span class='comma'>,</span> <span class='id identifier rubyid_tom'>tom</span><span class='period'>.</span><span class='id identifier rubyid_club_id'>club_id</span>
  <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='const'>Member</span><span class='period'>.</span><span class='id identifier rubyid_enroll'>enroll</span><span class='lparen'>(</span>
    <span class='id identifier rubyid_tom'>tom</span><span class='comma'>,</span> 
    <span class='id identifier rubyid_current_agent'>current_agent</span><span class='comma'>,</span> 
    <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:member</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:enrollment_amount</span><span class='rbracket'>]</span><span class='comma'>,</span> 
    <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:member</span><span class='rbracket'>]</span><span class='comma'>,</span> 
    <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:member</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:credit_card</span><span class='rbracket'>]</span><span class='comma'>,</span> 
    <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:setter</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:setter</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:cc_blank</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_to_bool'>to_bool</span><span class='comma'>,</span> 
    <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:setter</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:setter</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:skip_api_sync</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_to_bool'>to_bool</span>
  <span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>RecordNotFound</span>
  <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='lbrace'>{</span> <span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Terms of membership not found</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:code</span> <span class='op'>=&gt;</span> <span class='const'>Settings</span><span class='period'>.</span><span class='id identifier rubyid_error_codes'>error_codes</span><span class='period'>.</span><span class='id identifier rubyid_not_found'>not_found</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="show-instance_method">
  
    - (<tt>String</tt>, ...) <strong>show</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Method : GET Returns information related to member and its credit card.
</p>
<dl>
<dt>url</dt><dd><p>
/api/v1/members/:id
</p>
</dd>
<dt>id</dt><dd><p>
Members ID. This id is a string type ID (lenght 32 characters.). This ID is
unique for each member. Have in mind that this value is part of the url.  
</p>
</dd>
<dt>member</dt><dd><p>
Information related to the member that is sumbitting the enroll. Here is a
list of the regex we are using to validate <span class='object_link'><a href="../Member.html" title="Member (class)">show</a></span>.
</p>
<pre class="code ruby"><code>
   *first_name: The first name of the member that is enrolling. We are not accepting any invalid character (like: #$&quot;!#%&amp;%&quot;).
   *last_name: The last name of the member that is enrolling. We are not accepting any invalid character (like: #$&quot;!#%&amp;%&quot;).
   *address: The address of the member that is being enrolled. 
   *city: City from where the member is from.
   *state: The state standard code where the member is from.
   *zip: Member's address's zip code. We are accpeting only formats like: xxxxx or xxxxx-xxxx. Only numbers.
   *phone_country_code: First field of the phone number. This is the number related to the country the phone number is from. (Eg. For United States it would be &quot;011&quot;). 
   *phone_area_code: Second field of the phone number. This is the number related to the area the phone number is from. 
   *phone_local_number: Third and last field of the phone_number. This is the local number where the member will be reached.
   *email: Members personal email. This mail will be one of our contact method and every mail will be send to this. We are accepting
    mails with formtas like: xxxxxxxxx@xxxx.xxx.xx or xxxxxx+xxx@xxxx.xxx.xx
   *club_cash_amount: Amount of the club cash the member has at this moment. We accept a maximun of two digits after the comma.
</code></pre>
</dd>
<dt>credit_card</dt><dd><p>
Information related to member&#8217;s credit card.
</p>
<pre class="code ruby"><code>
  *expire_month: The month (in numbers) in which the credit card will expire. Eg. For june it would be 6. 
  *expire_year: The year (in numbers) in which the credit card will expire.  
</code></pre>
</dd>
<dt>enrollment_info</dt><dd><p>
Information obtained from the member&#8217;s enrollment
</p>
</dd>
</dl>
<pre class="code ruby"><code>
             *enrollment_amount
             *product_sku 
             *product_description 
             *mega_channel 
             *marketing_code 
             *fulfillment_code 
             *ip_address 
             *user_agent 
             *referral_host 
             *referral_parameters 
             *referral_path 
             *user_id 
             *landing_url 
             *cookie_value 
             *cookie_set 
             *campaign_medium 
             *campaign_description
             *campaign_medium_version 
             *joint 
             *prospect_id
</code></pre>
<dl>
<dt>message</dt><dd><p>
Shows the method results and also informs the errors.
</p>
</dd>
<dt>code</dt><dd><p>
Code related to the method result.
</p>
</dd>
</dl>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>*id*</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<b>message</b>
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<b>member</b>
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<b>credit_card</b>
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<b>code</b>
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/api/members_controller.rb', line 230</span>

<span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='id identifier rubyid_member'>member</span> <span class='op'>=</span> <span class='const'>Member</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_my_authorize!'>my_authorize!</span> <span class='symbol'>:api_profile</span><span class='comma'>,</span> <span class='const'>Member</span><span class='comma'>,</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_club_id'>club_id</span>
  <span class='id identifier rubyid_ei'>ei</span> <span class='op'>=</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_enrollment_infos'>enrollment_infos</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_ei'>ei</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_ei'>ei</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> 
    <span class='lbrace'>{</span><span class='rbrace'>}</span> 
  <span class='kw'>else</span>
    <span class='id identifier rubyid_ei'>ei</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='period'>.</span><span class='id identifier rubyid_symbolize_keys'>symbolize_keys</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span>
      <span class='symbol'>:enrollment_amount</span><span class='comma'>,</span> 
      <span class='symbol'>:product_sku</span><span class='comma'>,</span> 
      <span class='symbol'>:product_description</span><span class='comma'>,</span> 
      <span class='symbol'>:mega_channel</span><span class='comma'>,</span> 
      <span class='symbol'>:marketing_code</span><span class='comma'>,</span> 
      <span class='symbol'>:fulfillment_code</span><span class='comma'>,</span> 
      <span class='symbol'>:ip_address</span><span class='comma'>,</span> 
      <span class='symbol'>:user_agent</span><span class='comma'>,</span> 
      <span class='symbol'>:referral_host</span><span class='comma'>,</span> 
      <span class='symbol'>:referral_parameters</span><span class='comma'>,</span> 
      <span class='symbol'>:referral_path</span><span class='comma'>,</span> 
      <span class='symbol'>:user_id</span><span class='comma'>,</span> 
      <span class='symbol'>:landing_url</span><span class='comma'>,</span> 
      <span class='symbol'>:cookie_value</span><span class='comma'>,</span> 
      <span class='symbol'>:cookie_set</span><span class='comma'>,</span> 
      <span class='symbol'>:campaign_medium</span><span class='comma'>,</span> 
      <span class='symbol'>:campaign_description</span><span class='comma'>,</span>
      <span class='symbol'>:campaign_medium_version</span><span class='comma'>,</span> 
      <span class='symbol'>:joint</span><span class='comma'>,</span> 
      <span class='symbol'>:prospect_id</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='lbrace'>{</span>
    <span class='label'>code:</span> <span class='const'>Settings</span><span class='period'>.</span><span class='id identifier rubyid_error_codes'>error_codes</span><span class='period'>.</span><span class='id identifier rubyid_success'>success</span><span class='comma'>,</span>
    <span class='label'>member:</span> <span class='lbrace'>{</span>
      <span class='label'>first_name:</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_first_name'>first_name</span><span class='comma'>,</span> 
      <span class='label'>last_name:</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_last_name'>last_name</span><span class='comma'>,</span> 
      <span class='label'>email:</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span><span class='comma'>,</span>
      <span class='label'>address:</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> 
      <span class='label'>city:</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_city'>city</span><span class='comma'>,</span> 
      <span class='label'>state:</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> 
      <span class='label'>zip:</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_zip'>zip</span><span class='comma'>,</span>
      <span class='label'>phone_country_code:</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_phone_country_code'>phone_country_code</span><span class='comma'>,</span> 
      <span class='label'>phone_area_code:</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_phone_area_code'>phone_area_code</span><span class='comma'>,</span>
      <span class='label'>phone_local_number:</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_phone_local_number'>phone_local_number</span><span class='comma'>,</span> 
      <span class='label'>club_cash_amount:</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_club_cash_amount'>club_cash_amount</span>
    <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='label'>credit_card:</span> <span class='lbrace'>{</span>
      <span class='label'>expire_month:</span> <span class='lparen'>(</span><span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_active_credit_card'>active_credit_card</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_active_credit_card'>active_credit_card</span><span class='period'>.</span><span class='id identifier rubyid_expire_month'>expire_month</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>expire_year:</span> <span class='lparen'>(</span><span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_active_credit_card'>active_credit_card</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_active_credit_card'>active_credit_card</span><span class='period'>.</span><span class='id identifier rubyid_expire_year'>expire_year</span><span class='rparen'>)</span>
    <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='label'>enrollment_info:</span> <span class='id identifier rubyid_ei'>ei</span>
  <span class='rbrace'>}</span>
<span class='kw'>rescue</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>RecordNotFound</span>
  <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='lbrace'>{</span> <span class='label'>code:</span> <span class='const'>Settings</span><span class='period'>.</span><span class='id identifier rubyid_error_codes'>error_codes</span><span class='period'>.</span><span class='id identifier rubyid_not_found'>not_found</span><span class='comma'>,</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Member not found</span><span class='tstring_end'>'</span></span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update-instance_method">
  
    - (<tt>String</tt>, ...) <strong>update</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Method : PUT Updates member&#8217;s data.
</p>
<dl>
<dt>url</dt><dd><p>
/api/v1/members/:id
</p>
</dd>
<dt>id</dt><dd><p>
ID of the member. This ID is unique for each member. (32 characters
string). This value is used by platform. API users dont know the member id
at this moment. Have in mind that this value is part of the url.
</p>
</dd>
<dt>member</dt><dd><p>
Information related to the member that is being updated.. Here is a list of
the regex we are using to validate. <span class='object_link'><a href="../Member.html" title="Member (class)">show</a></span>.
</p>
<pre class="code ruby"><code>
   *first_name: The first name of the member that is enrolling. We are not accepting any invalid character (like: #$&quot;!#%&amp;%&quot;).
   *last_name: The last name of the member that is enrolling. We are not accepting any invalid character (like: #$&quot;!#%&amp;%&quot;). 
   *address: The address of the member that is being enrolled. 
   *city: City from where the member is from.
   *member_group_type_id: Id of the member's group type where he belongs to. Each club can has many classifications for its member's, like 'VIP' or 'Celebrity'.
    This types are stored as 'MemberGroupType'. The id is an integer up to 8 digits.
   *state: The state standard code where the member is from. 
   *zip: Member's address's zip code. We are accepting only formats like: xxxxx or xxxxx-xxxx. Only numbers.
   *country: The country standard code where the member is from. This code has a length of 2 digits. (Eg: US for United States).
   *phone_country_code: First field of the phone number. This is the number related to the country the phone number is from. (Eg. For United States it would be &quot;011&quot;). 
   *phone_area_code: Second field of the phone number. This is the number related to the area the phone number is from. 
  *phone_local_number: Third and last field of the phone_number. This is the local number where the member will be reached.
   *gender: Gender of the member. The values we are recieving are &quot;M&quot; for male or &quot;F&quot; for female.
   *type_of_phone_number: Type of the phone number the member has input (home, mobile, others).
   *email: Members personal email. This mail will be one of our contact method and every mail will be send to this. We are accepting
    mails with the following formats: xxxxxxxxx@xxxx.xxx.xx or xxxxxx+xxx@xxxx.xxx.xx
   *api_id: Send this value with the User Id of your site. This id is used to access your API (e.g. Autologin URL - Update member data). (optional)
</code></pre>
</dd>
<dt>setter</dt><dd><p>
Variable used to pass some boolean values as &#8220;cc_blank&#8221; for
enrolling or &#8220;wrong_address&#8221; for update.
</p>
<pre class="code ruby"><code>
 * wrong_phone_number: Boolean value that (if it is true) it will tell us to unset member's phone_number as wrong. (It will set 
                       wrong_phone_number as nil)
 * batch_update: Boolean variable which tell us if this update was made by a member or by a system. Send 1 if you want batch_update otherwise dont send this attribute (different operations will be stored) (optional)
 * skip_api_sync: Boolean variable which tell us if we have to sync or not user to remote api. Send 1 if you want to skip sync otherwise dont send this attribute. (optional) (e.g drupal)
</code></pre>
</dd>
<dt>message</dt><dd><p>
Shows the method results and also informs the errors.
</p>
</dd>
<dt>code</dt><dd><p>
Code related to the method result.
</p>
</dd>
<dt>v_id</dt><dd><p>
Visible id of the member that was updated.
</p>
</dd>
<dt>errors</dt><dd><p>
A hash with members errors. This will be use to show errors on members edit
page.
</p>
</dd>
</dl>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>member</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>setter</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<b>message</b>
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<b>member_id</b>
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<b>code</b>
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<b>errors</b>
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/api/members_controller.rb', line 142</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span>
  <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_batch_update'>batch_update</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:setter</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:setter</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:batch_update</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:setter</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:batch_update</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_to_bool'>to_bool</span>

  <span class='id identifier rubyid_member'>member</span> <span class='op'>=</span> <span class='const'>Member</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_my_authorize!'>my_authorize!</span> <span class='symbol'>:api_update</span><span class='comma'>,</span> <span class='const'>Member</span><span class='comma'>,</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_club_id'>club_id</span>
  <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_skip_api_sync!'>skip_api_sync!</span> <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:setter</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:setter</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:skip_api_sync</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:setter</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:skip_api_sync</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_to_bool'>to_bool</span>
  <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_api_id'>api_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:member</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:api_id</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:member</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:api_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='kw'>and</span> <span class='id identifier rubyid_batch_update'>batch_update</span>
  <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_wrong_phone_number'>wrong_phone_number</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:setter</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:wrong_phone_number</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_to_bool'>to_bool</span> <span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:setter</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_wrong_phone_number'>wrong_phone_number</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_phone_country_code'>phone_country_code</span> <span class='op'>!=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:member</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:phone_country_code</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>||</span> 
                                                        <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_phone_area_code'>phone_area_code</span> <span class='op'>!=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:member</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:phone_area_code</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>||</span>
                                                        <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_phone_local_number'>phone_local_number</span> <span class='op'>!=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:member</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:phone_local_number</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_update_credit_card_from_drupal'>update_credit_card_from_drupal</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:member</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:credit_card</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@current_agent</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='symbol'>:code</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='const'>Settings</span><span class='period'>.</span><span class='id identifier rubyid_error_codes'>error_codes</span><span class='period'>.</span><span class='id identifier rubyid_success'>success</span>
    <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_update_member_data_by_params'>update_member_data_by_params</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:member</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
      <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Member updated successfully</span><span class='tstring_end'>&quot;</span></span>
      <span class='const'>Auditory</span><span class='period'>.</span><span class='id identifier rubyid_audit'>audit</span><span class='lparen'>(</span><span class='id identifier rubyid_current_agent'>current_agent</span><span class='comma'>,</span> <span class='id identifier rubyid_member'>member</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='id identifier rubyid_member'>member</span><span class='comma'>,</span> <span class='const'>Settings</span><span class='period'>.</span><span class='id identifier rubyid_operation_types'>operation_types</span><span class='period'>.</span><span class='id identifier rubyid_profile_updated'>profile_updated</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_batch_update'>batch_update</span>
      <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='symbol'>:code</span> <span class='op'>=&gt;</span> <span class='const'>Settings</span><span class='period'>.</span><span class='id identifier rubyid_error_codes'>error_codes</span><span class='period'>.</span><span class='id identifier rubyid_success'>success</span><span class='comma'>,</span> <span class='symbol'>:member_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Member could not be updated, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_error_to_s'>error_to_s</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>if</span> <span class='id identifier rubyid_batch_update'>batch_update</span>
        <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Remote batch update message: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>else</span>
        <span class='const'>Auditory</span><span class='period'>.</span><span class='id identifier rubyid_audit'>audit</span><span class='lparen'>(</span><span class='id identifier rubyid_current_agent'>current_agent</span><span class='comma'>,</span> <span class='id identifier rubyid_member'>member</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='id identifier rubyid_member'>member</span><span class='comma'>,</span> <span class='const'>Settings</span><span class='period'>.</span><span class='id identifier rubyid_operation_types'>operation_types</span><span class='period'>.</span><span class='id identifier rubyid_profile_update_error'>profile_update_error</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>error_messages.member_data_invalid</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:code</span> <span class='op'>=&gt;</span> <span class='const'>Settings</span><span class='period'>.</span><span class='id identifier rubyid_error_codes'>error_codes</span><span class='period'>.</span><span class='id identifier rubyid_member_data_invalid'>member_data_invalid</span><span class='comma'>,</span> <span class='symbol'>:errors</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_member'>member</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='id identifier rubyid_response'>response</span>
<span class='kw'>rescue</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>RecordNotFound</span>
  <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='lbrace'>{</span> <span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Member not found</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:code</span> <span class='op'>=&gt;</span> <span class='const'>Settings</span><span class='period'>.</span><span class='id identifier rubyid_error_codes'>error_codes</span><span class='period'>.</span><span class='id identifier rubyid_not_found'>not_found</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Wed Feb 13 09:13:18 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.2.1 (ruby-1.9.2).
</div>

  </body>
</html>